(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{33:function(e,t,a){e.exports=a(74)},38:function(e,t,a){},72:function(e,t,a){},74:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(27),o=a.n(r),s=(a(38),a(19)),c=a(6),u=a(13),l=a(14),d=a(31),h=a(28),p=a(32),m=a(29),f=a.n(m),y=a(30),v=a.n(y),g=a(3),k=a(4);function b(e){if(!e.ok)throw Error(e.statusText);return e}function E(e){console.error(e)}var P=/.*"(audioteca-item|pagination-link)" (data-[^=]*)="([^"]*)"[ \t>]/g,D=/^.*[ \t](data-[^=]*)="([^"]*)"[ \t>].*$/,U=function(){function e(t){Object(u.a)(this,e),this._podcastsData={},this._pages_uuids=[],this._previous_uuids=[];this.date=t.date,this.onListUpdate=t.onListUpdate||function(){},this.updateList()}return Object(l.a)(e,[{key:"setDate",value:function(e){this.date!==e&&(this._previous_uuids=[]),this.date=e,this.updateList()}},{key:"updateList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return 0===e&&(this._pages_uuids=[],this.pages=[0],this.handleListUpdate()),this.getPodcastsUUIDs(e).then(this.getPodcasts.bind(this,e)).then(this.handleListUpdate.bind(this,e))}},{key:"getPodcasts",value:function(e,t){var a=this;return t.map(function(t){return"..."===t.uuid||t.uuid in a._podcastsData||a.getPodcastData(t.uuid).then(a.handlePodcastUpdate.bind(a,e)),t})}},{key:"handleListUpdate",value:function(){var e=this,t=Object(s.a)(this._previous_uuids.filter(function(e){return"..."!==e.uuid})),a=!0;this.pages.forEach(function(n){var i=e._pages_uuids[n];void 0===i?(t.push({uuid:"..."}),a=!1):i.filter(function(e){return 0===t.filter(function(t){return t.uuid===e.uuid}).length}).forEach(function(e){return t.push(e)})}),t=t.map(function(t){return e._podcastsData[t.uuid]||t}),a&&(this._previous_uuids=t);var n=a&&t.every(function(e){return"path"in e});return this.onListUpdate(t,n),t}},{key:"handlePodcastUpdate",value:function(e,t){var a=this;t.page=e,this._pages_uuids[e].forEach(function(n,i){n.uuid===t.uuid&&(a._pages_uuids[e][i]=t)}),this.handleListUpdate(t)}},{key:"getPodcastsUUIDs",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.getPage(t).then(function(a){var n=e.parsePage(a),i=n.uuidsPage,r=n.pages;return 0===t&&(e.pages=r.length>0?r.reverse():[0],e.pages.forEach(function(t){return 0!==t&&e.updateList(t)})),e._pages_uuids[t]=i.reverse().map(function(e){return{uuid:e,page:t}}),e._pages_uuids[t]})}},{key:"getPage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=function(e){return(e<10?"0":"")+e},a=t(this.date.getDate())+"/"+t(1+this.date.getMonth())+"/"+this.date.getFullYear();return fetch("https://cors-anywhere.herokuapp.com/https://api.audioteca.rac1.cat/a-la-carta/cerca?"+"text=&programId=&sectionId=HOUR&from=".concat(a,"&to=").concat(a,"&pageNumber=").concat(e),{credentials:"omit"}).then(b).then(function(e){return e.text()}).catch(E)}},{key:"parsePage",value:function(e){var t=["data-audio-id","data-audioteca-search-page"],a=(e.match(P)||[]).map(function(e){return e.replace(D,"$1=$2").split("=")}).filter(function(e){return t.includes(e[0])});return{uuidsPage:a.filter(function(e){return"data-audio-id"===e[0]}).map(function(e){return e[1]}),pages:a.filter(function(e){return"data-audioteca-search-page"===e[0]}).map(function(e){return Number(e[1])})}}},{key:"getPodcastData",value:function(e){var t=this;return e in this._podcastsData?new Promise(function(a){return a(t._podcastsData[e])}):fetch("https://api.audioteca.rac1.cat/piece/audio?id=".concat(e)).then(b).then(function(e){return e.json()}).then(function(a){return a.uuid=e,a.audio.hour=a.audio.time.split(":")[0],t._podcastsData[e]=a,a}).catch(E)}}]),e}(),w=(a(72),function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this))).state={podcasts:[{uuid:"..."}],currentUUID:"",date:new Date,volume:1,completed:!1,waitingUpdate:!1,controls:[]},a.controls=[{icon:i.a.createElement(g.a,{icon:k.c,flip:"horizontal"}),text:"Prev",action:a.playPrev},{icon:i.a.createElement("span",null,i.a.createElement(g.a,{icon:k.d,flip:"horizontal"}),i.a.createElement(g.a,{icon:k.d,flip:"horizontal"})),text:"-10m",action:function(){return a.player().currentTime-=600}},{icon:i.a.createElement("span",null,i.a.createElement(g.a,{icon:k.d,flip:"horizontal",style:{position:"relative",left:".25em"}}),i.a.createElement(g.a,{icon:k.d,flip:"horizontal",style:{position:"relative",left:"-.25em"}})),text:"-60s",action:function(){return a.player().currentTime-=60}},{icon:i.a.createElement(g.a,{icon:k.d,flip:"horizontal"}),text:"-10s",action:function(){return a.player().currentTime-=10}},{icon:i.a.createElement(g.a,{icon:k.b,rotation:90}),text:"Play/Pause",action:function(){return a.player().paused?a.player().play():a.player().pause()}},{icon:i.a.createElement(g.a,{icon:k.d}),text:"+10s",action:function(){return a.player().currentTime+=10}},{icon:i.a.createElement("span",null,i.a.createElement(g.a,{icon:k.d,style:{position:"relative",left:".25em"}}),i.a.createElement(g.a,{icon:k.d,style:{position:"relative",left:"-.25em"}})),text:"+60s",action:function(){return a.player().currentTime+=60}},{icon:i.a.createElement("span",null,i.a.createElement(g.a,{icon:k.d}),i.a.createElement(g.a,{icon:k.d})),text:"+10m",action:function(){return a.player().currentTime+=600}},{icon:i.a.createElement(g.a,{icon:k.c}),text:"Next",action:a.playNext}],/Mobi|Android/i.test(navigator.userAgent)?a.keyHandlerFocus=function(){}:a.keyHandlerFocus=function(e){var t=!0;e&&e.relatedTarget&&e.relatedTarget.className.match(/date-?picker/)&&(t=!1),t&&setTimeout(function(){return a._keyHandler.focus()},100)},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.keyHandlerFocus(),this.rac1=new U({date:this.state.date,onListUpdate:this.handleListUpdate.bind(this)}),this.setState(Object(c.a)({},this.state,{controls:this.controls}))}},{key:"render",value:function(){var e=this,t=this.state,a=t.podcasts,n=t.volume,r=t.completed,o=t.date,s=o instanceof Date?"".concat(o.getDate(),"/").concat(1+o.getMonth(),"/").concat(o.getFullYear()):"...",c=this.findCurrentPodcast(),u=c>0,l=void 0!==a&&a.length>c&&"path"in a[c]?a[c].path:"";return i.a.createElement("div",{className:"App"},i.a.createElement("header",{className:"App-header"},i.a.createElement("h3",null,void 0!==a&&a.length>0&&"audio"in a[c]?"".concat(s,": ").concat(a[c].appTabletTitle):s),i.a.createElement("input",{name:"player-key-handler",style:{width:"0px",height:"0px",border:0,margin:0,padding:0,position:"absolute"},ref:function(t){e._keyHandler=t},onKeyUp:this.handleKey.bind(this),onBlur:this.keyHandlerFocus.bind(this)}),i.a.createElement("div",null,this.state.controls.map(function(t,a){return i.a.createElement("button",{key:a,onClick:t.action.bind(e),style:{borderRadius:"1em",padding:"1em",margin:"1em"}},i.a.createElement("div",{style:{fontSize:"calc(1em + 2.5vmin)",fontWeight:"bold",minWidth:"1.5em"}},t.icon instanceof Function?t.icon():t.icon),i.a.createElement("span",{style:{fontSize:"calc(8px + 1vmin)",color:"#777"}},t.text instanceof Function?t.text():t.text))})),i.a.createElement(f.a,{ref:function(t){e._player=t},style:{width:"100%"},src:l,autoPlay:u,controls:!0,preload:u?"auto":"metadata",onEnded:this.playNext.bind(this),volume:n}),i.a.createElement("div",{style:{color:"#777",backgroundColor:"white",padding:"2em",borderRadius:"1em",margin:"1em",textAlign:"left",position:"relative"}},1===a.length&&"..."===a[0].uuid?null:i.a.createElement("button",{onClick:this.handleClickReload.bind(this),disabled:!r,style:{borderRadius:".5em",padding:".25em",margin:"1.5em",position:"absolute",top:0,right:0}},i.a.createElement("div",{style:{fontSize:"calc(.5em + 2vmin)",fontWeight:"bold",marginBottom:"-.25em"}},i.a.createElement(g.a,{icon:k.f})),i.a.createElement("span",{style:{fontSize:"calc(5px + 1vmin)",color:"#777"}},"Reload")),i.a.createElement("div",{style:{textAlign:"center",fontSize:"large"}},i.a.createElement(v.a,{onChange:this.handleDateChange.bind(this),onBlur:this.handleDateBlur.bind(this),minDate:new Date(2015,5,1),maxDate:new Date,required:!0,value:o,clearIcon:null,calendarIcon:i.a.createElement(g.a,{icon:k.a})})),void 0!==a&&a.length>0?i.a.createElement("ul",{style:{listStyleType:"none",marginLeft:0,paddingLeft:0}},a.map(function(t,a){return i.a.createElement("li",{key:"..."!==t.uuid?t.uuid:"..._".concat(a),style:{position:"relative",marginLeft:"1em"}},a===c&&"path"in t?i.a.createElement(g.a,{icon:k.e,style:{position:"absolute",left:"-1.25em",top:"calc(.2vmin + .2em)"}}):null,"path"in t?i.a.createElement("a",{href:t.path,onClick:e.handleClickPodcast.bind(e,a),style:{textDecoration:"none"}},t.audio.hour,"h: ",t.appTabletTitle):i.a.createElement("span",null,t.uuid))})):null)))}},{key:"handleListUpdate",value:function(e,t){var a=this.state.waitingUpdate,n=(!a||!t)&&a;this.setState(Object(c.a)({},this.state,{podcasts:e,completed:t,waitingUpdate:n})),!0===a&&!1===n&&this.playNext(!1)}},{key:"handleDateChange",value:function(e){e!==this.state.date&&(null!==e&&this.rac1.setDate(e),this.setState(Object(c.a)({},this.state,{date:e})))}},{key:"handleDateBlur",value:function(e){var t=!0;e&&e.relatedTarget&&e.relatedTarget.className.match(/(calendar|date-?picker)/)&&(t=!1),t&&this.keyHandlerFocus()}},{key:"handleClickReload",value:function(){if(this.state.completed)return this.setState(Object(c.a)({},this.state,{completed:!1})),this.rac1.updateList()}},{key:"findPodcastByUUID",value:function(e){var t=0;return this.state.podcasts.forEach(function(a,n){a.uuid===e&&(t=n)}),t}},{key:"findCurrentPodcast",value:function(){return this.findPodcastByUUID(this.state.currentUUID)}},{key:"playPodcast",value:function(e){this.setState(Object(c.a)({},this.state,{currentUUID:this.state.podcasts[e].uuid}))}},{key:"playPrev",value:function(){var e=this.findCurrentPodcast();e>0&&this.playPodcast(e-1)}},{key:"playNext",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.findCurrentPodcast();t<this.state.podcasts.length-1&&"path"in this.state.podcasts[t]?this.playPodcast(t+1):e&&(this.state.waitingUpdate||(this.handleClickReload(),this.setState(Object(c.a)({},this.state,{waitingUpdate:!0}))))}},{key:"player",value:function(){return this._player.audioEl}},{key:"handleClickPodcast",value:function(e,t){t.stopPropagation(),t.preventDefault(),this.playPodcast(e)}},{key:"setVolume",value:function(e){this.player().volume=e,this.setState(Object(c.a)({},this.state,{volume:e}))}},{key:"incrementVolume",value:function(e){var t=this.state.volume,a=t;e>0&&t<1&&(a=t<=1-e?t+e:1),e<0&&t>0&&(a=t>=-e?t+e:0),a!==t&&this.setVolume(a)}},{key:"handleKey",value:function(e){var t=!0;switch(e.key){case"Enter":this.playNext();break;case" ":case"p":case"P":this.player().paused?this.player().play():this.player().pause();break;case"ArrowLeft":this.player().currentTime-=10;break;case"ArrowRight":this.player().currentTime+=10;break;case"ArrowUp":e.shiftKey?this.incrementVolume(.05):this.player().currentTime-=60;break;case"ArrowDown":e.shiftKey?this.incrementVolume(-.05):this.player().currentTime+=60;break;case"PageUp":this.player().currentTime-=600;break;case"PageDown":this.player().currentTime+=600;break;case"*":this.incrementVolume(.05);break;case"/":this.incrementVolume(-.05);break;case"m":case"M":this.player().muted=!this.player().muted;break;case"r":case"R":this.handleClickReload();break;default:t=!1}t&&(e.stopPropagation(),e.preventDefault())}}]),t}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(w,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[33,2,1]]]);
//# sourceMappingURL=main.bbb941dc.chunk.js.map