(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{42:function(e,t,n){"use strict";(function(e){var a=n(7),i=n(6),o=n(12),r=n(10),c=n(11),s=n(0),u=n(1),l=n(26),d=function(t){function n(){var e;Object(a.a)(this,n);return(e=Object(o.a)(this,Object(r.a)(n).call(this))).loadGoogleTag("UA-129704402-1"),l.a.initialize("UA-129704402-1"),e}return Object(c.a)(n,t),Object(i.a)(n,[{key:"componentDidMount",value:function(){this.sendPageView(this.context.router.history.location),this.context.router.history.listen(this.sendPageView)}},{key:"sendPageView",value:function(e){l.a.set({page:e.pathname}),l.a.pageview(e.pathname)}},{key:"loadGoogleTag",value:function(t){e.dataLayer=e.dataLayer||[],e.gtag=function(){e.dataLayer.push(arguments)},e.gtag("js",new Date),e.gtag("config",t),setTimeout(function(){var e=document.createElement("script");e.src="https://www.googletagmanager.com/gtag/js?id=".concat(t),document.body.appendChild(e)},1)}},{key:"render",value:function(){return this.props.children}}]),n}(s.Component);d.contextTypes={router:u.PropTypes.object},t.a=d}).call(this,n(33))},43:function(e,t,n){e.exports=n(84)},48:function(e,t,n){},81:function(e,t,n){},84:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),o=n(39),r=n.n(o),c=(n(48),n(25)),s=n(14),u=n(7),l=n(12),d=n(10),h=n(6),p=n(11),f=n(19),m=n(87),y=n(88),g=n(89),v=n(86),b=n(40),k=n.n(b),P=n(3),w=n(4),D=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this))).controls=[{icon:i.a.createElement(P.a,{icon:w.c,flip:"horizontal"}),text:"Prev",help:"Play previous podcast",action:function(){return n.props.onPlayPrev()}},{icon:i.a.createElement("span",null,i.a.createElement(P.a,{icon:w.d,flip:"horizontal"}),i.a.createElement(P.a,{icon:w.d,flip:"horizontal"})),text:"-10m",help:"Go backwards 10 minutes",action:function(){return n.player().currentTime-=600},keys:["PageUp"]},{icon:i.a.createElement("span",null,i.a.createElement(P.a,{icon:w.d,flip:"horizontal",style:{position:"relative",left:".25em"}}),i.a.createElement(P.a,{icon:w.d,flip:"horizontal",style:{position:"relative",left:"-.25em"}})),text:"-60s",help:"Go backwards 1 minute",action:function(){return n.player().currentTime-=60},keys:["ArrowUp"]},{icon:i.a.createElement(P.a,{icon:w.d,flip:"horizontal"}),text:"-10s",help:"Go backwards 10 seconds",action:function(){return n.player().currentTime-=10},keys:["ArrowLeft"]},{icon:i.a.createElement(P.a,{icon:w.b,rotation:90}),text:"Play/Pause",help:"Toggle Play/Pause",action:function(){return n.player().paused?n.player().play():n.player().pause()},keys:[" ","p","P"]},{icon:i.a.createElement(P.a,{icon:w.d}),text:"+10s",help:"Go forward 10 seconds",action:function(){return n.player().currentTime+=10},keys:["ArrowRight"]},{icon:i.a.createElement("span",null,i.a.createElement(P.a,{icon:w.d,style:{position:"relative",left:".25em"}}),i.a.createElement(P.a,{icon:w.d,style:{position:"relative",left:"-.25em"}})),text:"+60s",help:"Go forward 1 minute",action:function(){return n.player().currentTime+=60},keys:["ArrowDown"]},{icon:i.a.createElement("span",null,i.a.createElement(P.a,{icon:w.d}),i.a.createElement(P.a,{icon:w.d})),text:"+10m",help:"Go forward 10 minutes",action:function(){return n.player().currentTime+=600},keys:["PageDown"]},{icon:i.a.createElement(P.a,{icon:w.c}),text:"Next",help:"Play next podcast",action:function(){return n.props.onPlayNext()},keys:["Enter"]},{help:"Decrement volume 5%",action:function(){return n.incrementVolume(-.05)},keys:["/",{key:"ArrowDown",shiftKey:!0}]},{help:"Increment volume 5%",action:function(){return n.incrementVolume(.05)},keys:["*",{key:"ArrowUp",shiftKey:!0}]},{help:"Toggle mute status",action:function(){return n.player().muted=!n.player().muted},keys:["m","M"]}],n.keyHandlerFocus=function(){},n._keyHandlerFocus=function(e,t){var a=!0;e&&e.relatedTarget&&n.props.allowFocus(e.relatedTarget)&&(a=!1),(a||t)&&setTimeout(function(){return n._keyHandler.focus()},100)},n.player=function(){return n.props.getPlayer()},e.extraControls.length&&(n.controls=n.controls.concat(e.extraControls)),n}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){/Mobi|Android/i.test(navigator.userAgent)||(this.keyHandlerFocus=this._keyHandlerFocus,this.keyHandlerFocus())}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,this.controls.filter(function(e){return"icon"in e}).map(function(t,n){return i.a.createElement("button",{key:n,onClick:t.action.bind(e),onMouseUp:function(t){return e.keyHandlerFocus(t,!0)},"aria-label":t.help,title:t.help,className:"rac1-controls-button",style:{borderRadius:"1em",padding:"1em",margin:"1em"}},i.a.createElement("div",{style:{fontSize:"calc(1em + 2.5vmin)",fontWeight:"bold",minWidth:"1.5em"}},t.icon instanceof Function?t.icon():t.icon),i.a.createElement("span",{style:{fontSize:"calc(8px + 1vmin)",color:"#333"}},t.text instanceof Function?t.text():t.text))}),i.a.createElement("input",{name:"player-key-handler",style:{width:"1px",height:"1px",border:0,margin:0,padding:0,bottom:0,right:0,position:"fixed",backgroundColor:"transparent",color:"transparent",cursor:"default"},ref:function(t){e._keyHandler=t},onKeyUp:this.handleKey.bind(this),onBlur:this.keyHandlerFocus.bind(this),"aria-label":"Key input handler"}))}},{key:"setVolume",value:function(e){this.player().volume=e,this.props.onSetVolume(e)}},{key:"incrementVolume",value:function(e){var t=this.props.volume,n=t;e>0&&t<1&&(n=t<=1-e?t+e:1),e<0&&t>0&&(n=t>=-e?t+e:0),n!==t&&this.setVolume(n)}},{key:"handleKey",value:function(e){var t=!1;this.controls.forEach(function(n){(n.keys||[]).forEach(function(a){var i="string"===typeof a?{key:a}:a;e.key===i.key&&["shiftKey","altKey","ctrlKey","metaKey"].every(function(t){return!!e[t]===!!i[t]})&&(console.log(n.help),t=!0,n.action())})}),t&&(e.stopPropagation(),e.preventDefault())}}]),t}(i.a.PureComponent);D.defaultProps={onSetVolume:function(e){},onPlayPrev:function(e){},onPlayNext:function(e){},extraControls:[],volume:1};var E=D,j=n(41),O=n.n(j),x=function(e){return i.a.createElement("button",Object.assign({},e,{"aria-label":"Reload",style:{borderRadius:".5em",padding:".25em",margin:"0 0 0 1em"}}),i.a.createElement("div",{style:{fontSize:"calc(.5em + 2vmin)",fontWeight:"bold",marginBottom:"-.25em"}},i.a.createElement(P.a,{icon:w.f})),i.a.createElement("span",{style:{fontSize:"calc(5px + 1vmin)",color:"#333"}},"Reload"))},U=function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props,t=e.completedDownload,n=e.date,a=e.children,o=e.minDate,r=e.maxDate;return i.a.createElement("div",{style:{color:"#333",backgroundColor:"white",padding:"2em",borderRadius:"1em",margin:"1em",textAlign:"left",position:"relative",fontSize:"large"}},i.a.createElement("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center"}},i.a.createElement(O.a,{onChange:this.handleDateChange.bind(this),onBlur:this.handleDateBlur.bind(this),minDate:o,maxDate:r,required:!0,value:n,clearIcon:null,calendarIcon:i.a.createElement(P.a,{icon:w.a})}),i.a.createElement(x,{onClick:this.props.onClickReload.bind(this),disabled:!t})),i.a.createElement("div",{style:{textAlign:"center"}},a))}},{key:"handleDateChange",value:function(e){e.setHours(0),e.setMinutes(0),this.props.onDateChange(e)}},{key:"handleDateBlur",value:function(e){var t=!0;e&&e.relatedTarget&&e.relatedTarget.className.match(/(calendar|date-?picker)/)&&(t=!1),t&&this.props.onDateBlur(e)}}]),t}(i.a.PureComponent);U.defaultProps={onClickReload:function(e){},onDateBlur:function(e){},onDateChange:function(e){},completedDownload:!0,date:new Date,maxDate:new Date};var C=U,_=function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.current;return void 0===t||0===t.length?null:i.a.createElement("ul",{style:{listStyleType:"none",marginLeft:0,paddingLeft:0,textAlign:"left"}},t.map(function(e,t){return i.a.createElement("li",{key:e.key,style:{position:"relative",marginLeft:"2.5em",textIndent:"-1.5em",padding:"1pt 0"}},t===n?i.a.createElement(P.a,{icon:w.e,style:{position:"absolute",left:"-2.75em",padding:"1pt 0"}}):null,e)}))}}]),t}(i.a.PureComponent);_.defaultProps={};var T=_,F=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleClick=function(e){return n.props.onClick(e)},n}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e,t=this.props,n=t.path,a=t.uuid,o=t.hour,r=t.minute,c=t.title;return i.a.createElement("span",null,n?i.a.createElement("a",{href:n,onClick:this.handleClick.bind(this),style:{textDecoration:"none"}},o,"h",r?((e=r)<10?"0":"")+e:"",": ",c):i.a.createElement("span",null,a))}}]),t}(i.a.PureComponent);F.defaultProps={onClick:function(e){}};var L=F,H=n(42);function N(e){if(!e.ok)throw Error(e.statusText);return e}function R(e){console.error(e)}var A=/ class="(audioteca-item|pagination-link)" /,I=/.* (data-[^=]*)="([^"]*)".*/,S=function(){function e(t){Object(u.a)(this,e),this._podcastsData={},this._pages_uuids=[],this._previous_uuids=[];this.date=t.date,this.onListUpdate=t.onListUpdate||function(){},this.updateList()}return Object(h.a)(e,[{key:"setDate",value:function(e){this.date!==e&&(this._previous_uuids=[]),this.date=e,this.updateList()}},{key:"updateList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return 0===e&&(this._pages_uuids=[],this.pages=[0],this.handleListUpdate()),this.getPodcastsUUIDs(e).then(this.getPodcasts.bind(this,e)).then(this.handleListUpdate.bind(this,e))}},{key:"getPodcasts",value:function(e,t){var n=this;return t.map(function(t){return"..."===t.uuid||t.uuid in n._podcastsData||n.getPodcastData(t.uuid).then(n.handlePodcastUpdate.bind(n,e)),t})}},{key:"handleListUpdate",value:function(){var e=this,t=Object(c.a)(this._previous_uuids.filter(function(e){return"..."!==e.uuid})),n=!0;this.pages.forEach(function(a){var i=e._pages_uuids[a];void 0===i?(t.push({uuid:"..."}),n=!1):i.filter(function(e){return 0===t.filter(function(t){return t.uuid===e.uuid}).length}).forEach(function(e){return t.push(e)})}),t=t.map(function(t){return e._podcastsData[t.uuid]||t}),n&&(this._previous_uuids=t);var a=n&&t.every(function(e){return"path"in e});return this.onListUpdate(t,a),t}},{key:"handlePodcastUpdate",value:function(e,t){var n=this;t.page=e,this._pages_uuids[e].forEach(function(a,i){a.uuid===t.uuid&&(n._pages_uuids[e][i]=t)}),this.handleListUpdate(t)}},{key:"getPodcastsUUIDs",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.getPage(t).then(function(n){var a=e.parsePage(n),i=a.uuidsPage,o=a.pages;return 0===t&&(e.pages=o.length>0?o.reverse():[0],e.pages.forEach(function(t){return 0!==t&&e.updateList(t)})),e._pages_uuids[t]=i.reverse().map(function(e){return{uuid:e,page:t}}),e._pages_uuids[t]})}},{key:"getPage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=function(e){return(e<10?"0":"")+e},n=t(this.date.getDate())+"/"+t(1+this.date.getMonth())+"/"+this.date.getFullYear();return fetch("https://cors-anywhere.herokuapp.com/https://api.audioteca.rac1.cat/a-la-carta/cerca?"+"text=&programId=&sectionId=HOUR&from=".concat(n,"&to=").concat(n,"&pageNumber=").concat(e),{credentials:"same-origin"}).then(N).then(function(e){return e.text()}).catch(R)}},{key:"parsePage",value:function(e){var t=["data-audio-id","data-audioteca-search-page"],n=e.split("\n").filter(function(e){return A.test(e)}).map(function(e){return e.replace(I,"$1=$2")}).map(function(e){return e.split("=")}).filter(function(e){return t.includes(e[0])});return{uuidsPage:n.filter(function(e){return"data-audio-id"===e[0]}).map(function(e){return e[1]}),pages:n.filter(function(e){return"data-audioteca-search-page"===e[0]}).map(function(e){return Number(e[1])})}}},{key:"getPodcastData",value:function(e){var t=this;return e in this._podcastsData?new Promise(function(n){return n(t._podcastsData[e])}):fetch("https://api.audioteca.rac1.cat/piece/audio?id=".concat(e)).then(N).then(function(e){return e.json()}).then(function(n){return n.uuid=e,n.hour=Number(n.audio.time.split(":")[0]),n.minute=Number(n.audio.time.split(":")[1]),n.title=n.appTabletTitle.replace(/ \d\d\/.*/,""),n.titleFull=n.appTabletTitle,n.path=n.path.replace(/\/get\//,"/file/").replace(/\/(\d)\//,"/$1/-/"),t._podcastsData[e]=n,n}).catch(R)}}]),e}(),M=(n(81),function(e){function t(e,n){var a;return Object(u.a)(this,t),(a=Object(l.a)(this,Object(d.a)(t).call(this))).history=e.history,a.initialTitle=document.title,a.state={podcasts:[{uuid:"..."}],currentUUID:"",date:a.getDateFromParams(e),maxDate:new Date,volume:1,completed:!1,waitingUpdate:!1},a.extraControls=[{help:"Reload playlist",action:a.handleClickReload.bind(Object(f.a)(Object(f.a)(a))),keys:["r","R"]}],a}return Object(p.a)(t,e),Object(h.a)(t,[{key:"getDateFromParams",value:function(e){var t=e.match.params;return new Date(t.year,t.month-1,t.day,t.hour,t.minute)}}]),Object(h.a)(t,[{key:"componentWillMount",value:function(){this.unlisten=this.history.listen(this.handleHistoryChange.bind(this)),this.rac1=new S({date:this.state.date,onListUpdate:this.handleListUpdate.bind(this)})}},{key:"componentWillUnmount",value:function(){this.unlisten()}},{key:"render",value:function(){var e=this,t=this.state,n=t.podcasts,a=t.volume,o=t.completed,r=t.date,c=t.maxDate,u=r instanceof Date?"".concat(r.getDate(),"/").concat(1+r.getMonth(),"/").concat(r.getFullYear()):"...",l=this.findCurrentPodcast(),d=l>0,h=void 0!==n&&n.length>l&&"path"in n[l]?n[l].path:"",p=void 0!==n&&n.length>0&&"audio"in n[l]?"".concat(n[l].titleFull):u;return i.a.createElement("div",{className:"App"},i.a.createElement("header",{className:"App-header"},i.a.createElement("h3",null,p),i.a.createElement(E,{getPlayer:this.player.bind(this),volume:a,allowFocus:function(e){return e.className.match(/date-?picker/)},onPlayNext:this.playNext.bind(this),onPlayPrev:this.playPrev.bind(this),onSetVolume:function(t){return e.setState(Object(s.a)({},e.state,{volume:t}))},ref:function(t){t&&(e.keyHandlerFocus=t.keyHandlerFocus)},extraControls:this.extraControls}),i.a.createElement(k.a,{ref:function(t){e._player=t},style:{width:"100%"},src:h,autoPlay:d,controls:!0,controlsList:"nodownload",preload:d?"auto":"metadata",onEnded:this.playNext.bind(this),volume:a}),i.a.createElement(C,{date:r,minDate:new Date(2015,5,1),maxDate:c,completedDownload:o,onClickReload:this.handleClickReload.bind(this),onDateBlur:function(){return e.keyHandlerFocus()},onDateChange:this.handleDateChange.bind(this)},i.a.createElement(T,{current:l},n.map(function(t,n){return i.a.createElement(L,Object.assign({key:"..."!==t.uuid?t.uuid:"..._".concat(n)},t,{onClick:e.handlePodcastClick.bind(e,n)}))})))))}},{key:"handleHistoryChange",value:function(e,t){var n=this.getDateFromParams(this.props),a=this.state.date;"POP"===t&&(a.getFullYear()!==n.getFullYear()||a.getMonth()!==n.getMonth()||a.getDate()!==n.getDate()?this.handleDateChange(n):a.getHours()===n.getHours()&&a.getMinutes()===n.getMinutes()||(this.setState(Object(s.a)({},this.state,{currentUUID:"",dateNew:n})),this.selectPodcastByDate(n,!1)))}},{key:"historyPush",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="/".concat(e.getFullYear(),"/").concat(1+e.getMonth(),"/").concat(e.getDate(),"/").concat(e.getHours(),"/").concat(e.getMinutes());this.history.location.pathname!==n&&(t?this.history.replace(n):this.history.push(n))}},{key:"handleListUpdate",value:function(e,t){var n=this.state,a=n.waitingUpdate,i=n.currentUUID,o=n.date,r=(!a||!t)&&a;this.setState(Object(s.a)({},this.state,{podcasts:e,completed:t,waitingUpdate:r,maxDate:new Date})),t&&""===i&&this.selectPodcastByDate(o),!0===a&&!1===r&&this.playNext(!1)}},{key:"handleDateChange",value:function(e){var t=this;e!==this.state.date&&(this.setState(Object(s.a)({},this.state,{currentUUID:"",date:e})),null!==e&&(this.historyPush(e),setTimeout(function(){return t.rac1.setDate(e)},50)))}},{key:"handlePodcastsLastRemove",value:function(){this.setState(Object(s.a)({},this.state,{podcasts:Object(c.a)(this.state.podcasts).slice(0,-1)}))}},{key:"handleClickReload",value:function(){if(this.state.completed)return this.setState(Object(s.a)({},this.state,{completed:!1})),this.rac1.updateList()}},{key:"selectPodcastByDate",value:function(e){var t=this.state.podcasts.filter(function(t){return t.hour>=e.getHours()&&(t.hour>e.getHours()||t.minute>=e.getMinutes())});t.length>0&&this.playPodcast(this.findPodcastByUUID(t[0].uuid))}},{key:"findPodcastByUUID",value:function(e){var t=0;return this.state.podcasts.forEach(function(n,a){n.uuid===e&&(t=a)}),t}},{key:"findCurrentPodcast",value:function(){return this.findPodcastByUUID(this.state.currentUUID)}},{key:"playPodcast",value:function(e){var t,n=this.state,a=n.date,i=n.currentUUID,o=this.state.podcasts[e];o.hour===a.getHours()&&o.minute===a.getMinutes()||(a.setHours(Number(o.hour)),a.setMinutes(Number(o.minute))),t=""===i,document.title="".concat(this.initialTitle,": ").concat(o.titleFull),this.setState(Object(s.a)({},this.state,{currentUUID:o.uuid,date:a})),this.historyPush(a,t)}},{key:"playPrev",value:function(){var e=this.findCurrentPodcast();e>0&&this.playPodcast(e-1)}},{key:"playNext",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.findCurrentPodcast();t<this.state.podcasts.length-1&&"path"in this.state.podcasts[t]?this.playPodcast(t+1):e&&(this.state.waitingUpdate||(this.handleClickReload(),this.setState(Object(s.a)({},this.state,{waitingUpdate:!0}))))}},{key:"player",value:function(){return this._player.audioEl}},{key:"handlePodcastClick",value:function(e,t){t.stopPropagation(),t.preventDefault(),this.playPodcast(e)}}]),t}(a.Component)),B=function(e){function t(){return Object(u.a)(this,t),Object(l.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=new Date,t="/".concat(e.getFullYear(),"/").concat(1+e.getMonth(),"/").concat(e.getDate(),"/0/0");return i.a.createElement(m.a,null,i.a.createElement(H.a,null,i.a.createElement(y.a,null,i.a.createElement(g.a,{path:"/:year/:month/:day/:hour/:minute",render:function(e){return i.a.createElement(M,e)}}),i.a.createElement(v.a,{to:{pathname:t}}))))}}]),t}(a.Component),z=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function W(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}r.a.render(i.a.createElement(B,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/Rac1.js",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/Rac1.js","/service-worker.js");z?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):W(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):W(t,e)})}}()}},[[43,2,1]]]);
//# sourceMappingURL=main.72a125dd.chunk.js.map