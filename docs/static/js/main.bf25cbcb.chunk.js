(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(t,e,a){t.exports=a(23)},16:function(t,e,a){},21:function(t,e,a){},23:function(t,e,a){"use strict";a.r(e);var n=a(0),i=a.n(n),s=a(5),r=a.n(s),o=(a(16),a(8)),c=a(1),u=a(2),d=a(3),l=a(9),h=a(6),p=a(10),f=a(7),m=a.n(f);function y(t){if(!t.ok)throw Error(t.statusText);return t}function g(t){console.error(t)}var v=/.*"(audioteca-item|pagination-link)" (data-[^=]*)="([^"]*)"[ \t>]/g,k=/^.*[ \t](data-[^=]*)="([^"]*)"[ \t>].*$/,b=function(){function t(e){Object(u.a)(this,t);var a=function(){};this.date=e.date,this.onListUpdate=e.onListUpdate||a,this.onPodcastUpdate=e.onPodcastUpdate||a,this._podcastsData={},this._pages_uuids=[],this.getPodcastsUUIDs().then(this.getPodcasts.bind(this,0))}return Object(d.a)(t,[{key:"getPodcasts",value:function(t,e){var a=this;return this.handleListUpdate(),e.map(function(e){return"..."!==e.uuid&&a.getPodcastData(e.uuid).then(a.handlePodcastUpdate.bind(a,t)),e})}},{key:"handleListUpdate",value:function(){var t=this,e=[];this.pages.forEach(function(a){var n=t._pages_uuids[a];void 0===n?e.push({uuid:"..."}):n.forEach(function(t){0===e.filter(function(e){return e.uuid===t.uuid}).length&&e.push(t)})}),this.onListUpdate(e)}},{key:"handlePodcastUpdate",value:function(t,e){var a=this;e.page=t,this._pages_uuids[t].forEach(function(n,i){n.uuid===e.uuid&&(a._pages_uuids[t][i]=e)}),this.onPodcastUpdate(e)}},{key:"getPodcastsUUIDs",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.getPage(e).then(function(a){var n=t.parsePage(a),i=n.uuidsPage,s=n.pages;if(0===e)for(var r in s.length>0?t.pages=s.reverse():t.pages=[0],t.pages)0!==t.pages[r]&&t.getPodcastsUUIDs(t.pages[r]).then(t.getPodcasts.bind(t,t.pages[r]));return t._pages_uuids[e]=i.reverse().map(function(t){return{uuid:t,page:e}}),t._pages_uuids[e]})}},{key:"getPage",value:function(t){var e=function(t){return(t<10?"0":"")+t},a=e(this.date.getDate())+"/"+e(1+this.date.getMonth())+"/"+this.date.getFullYear();return fetch("https://cors-anywhere.herokuapp.com/https://api.audioteca.rac1.cat/a-la-carta/cerca?"+"text=&programId=&sectionId=HOUR&from=".concat(a,"&to=").concat(a,"&pageNumber=").concat(t),{credentials:"omit"}).then(y).then(function(t){return t.text()}).catch(g)}},{key:"parsePage",value:function(t){var e=["data-audio-id","data-audioteca-search-page"],a=t.match(v).map(function(t){return t.replace(k,"$1=$2").split("=")}).filter(function(t){return e.includes(t[0])});return{uuidsPage:a.filter(function(t){return"data-audio-id"===t[0]}).map(function(t){return t[1]}),pages:a.filter(function(t){return"data-audioteca-search-page"===t[0]}).map(function(t){return Number(t[1])})}}},{key:"getPodcastData",value:function(t){var e=this;return t in this._podcastsData?new Promise(function(t){return t(e._podcastsData)}):fetch("https://api.audioteca.rac1.cat/piece/audio?id=".concat(t)).then(y).then(function(t){return t.json()}).then(function(a){return a.uuid=t,a.audio.hour=a.audio.time.split(":")[0],e._podcastsData[t]=a,a}).catch(g)}}]),t}(),P=(a(21),function(t){function e(t){var a;return Object(u.a)(this,e),(a=Object(l.a)(this,Object(h.a)(e).call(this))).state={podcasts:[],currentUUID:"",date:new Date,volume:1,controls:[]},a.controls=[{icon:"\u23ee",text:"Prev",action:a.playPrev},{icon:i.a.createElement("span",{style:{letterSpacing:-10,paddingRight:11}},"\u2bc7\u2bc7\u2bc7"),text:"-10m",action:function(){return a.player().currentTime-=600}},{icon:i.a.createElement("span",{style:{letterSpacing:-10,paddingRight:11}},"\u2bc7\u2bc7"),text:"-60s",action:function(){return a.player().currentTime-=60}},{icon:"\u2bc7",text:"-10s",action:function(){return a.player().currentTime-=10}},{icon:"\u25ae\u25b6",text:"Play/Pause",action:function(){return a.player().paused?a.player().play():a.player().pause()}},{icon:"\u2bc8",text:"+10s",action:function(){return a.player().currentTime+=10}},{icon:i.a.createElement("span",{style:{letterSpacing:-10,paddingRight:11}},"\u2bc8\u2bc8"),text:"+60s",action:function(){return a.player().currentTime+=60}},{icon:i.a.createElement("span",{style:{letterSpacing:-10,paddingRight:11}},"\u2bc8\u2bc8\u2bc8"),text:"+10m",action:function(){return a.player().currentTime+=600}},{icon:"\u23ed",text:"Next",action:a.playNext}],/Mobi|Android/i.test(navigator.userAgent)?a.keyHandlerFocus=function(){}:a.keyHandlerFocus=function(){return a._keyHandler.focus()},a}return Object(p.a)(e,t),Object(d.a)(e,[{key:"componentDidMount",value:function(){this.keyHandlerFocus(),this.rac1=new b({date:this.state.date,onListUpdate:this.handleListUpdate.bind(this),onPodcastUpdate:this.handlePodcastUpdate.bind(this)}),this.setState(Object(c.a)({},this.state,{controls:this.controls}))}},{key:"render",value:function(){var t=this,e=this.state,a=e.podcasts,n=e.volume,s=this.findCurrentPodcast(),r=s>0;return i.a.createElement("div",{className:"App"},i.a.createElement("header",{className:"App-header"},void 0!==a&&a.length>0?i.a.createElement("h3",null,"audio"in a[s]?a[s].audio.title:a[s].uuid):null,i.a.createElement("input",{name:"player-key-handler",style:{width:"0px",height:"0px",border:0,margin:0,padding:0,position:"absolute"},ref:function(e){t._keyHandler=e},onKeyUp:this.handleKey.bind(this),onBlur:this.keyHandlerFocus.bind(this)}),i.a.createElement("div",null,this.state.controls.map(function(e,a){return i.a.createElement("button",{key:a,onClick:e.action.bind(t),style:{borderRadius:"1em",padding:"1em",margin:"1em"}},i.a.createElement("div",{style:{fontSize:30,fontWeight:"bold",width:"2em"}},e.icon instanceof Function?e.icon():e.icon),i.a.createElement("span",{style:{fontSize:9,color:"#777"}},e.text instanceof Function?e.text():e.text))})),i.a.createElement(m.a,{ref:function(e){t._player=e},style:{width:"100%"},src:void 0!==a&&a.length>s&&"path"in a[s]?a[s].path:"",autoPlay:r,controls:!0,preload:r?"auto":"metadata",onEnded:this.playNext.bind(this),volume:n}),i.a.createElement("div",{style:{color:"#777",backgroundColor:"white",padding:"2em",borderRadius:"1em",margin:"1em",textAlign:"left"}},void 0!==a&&a.length>0?i.a.createElement("ul",{style:{listStyleType:"none",marginLeft:0,paddingLeft:0}},a.map(function(e,a){return i.a.createElement("li",{key:e.uuid,style:{position:"relative",marginLeft:"1em"}},a!==s?null:i.a.createElement("span",{style:{position:"absolute",left:"-1em"}},"\u2bc8"),"path"in e?i.a.createElement("a",{href:e.path,onClick:t.handleClickPodcast.bind(t,a),style:{textDecoration:"none"}},e.audio.hour,"h: ",e.audio.title):i.a.createElement("span",null,e.uuid))})):null)))}},{key:"handleListUpdate",value:function(t){console.log({newList:t}),this.setState(Object(c.a)({},this.state,{podcasts:t}))}},{key:"handlePodcastUpdate",value:function(t){var e=this.state.podcasts;for(var a in console.log({podcastNew:t}),this.state.podcasts){var n=this.state.podcasts[a];t.uuid===n.uuid&&((e=Object(o.a)(e))[a]=t)}this.setState(Object(c.a)({},this.state,{podcasts:e}))}},{key:"findPodcastByUUID",value:function(t){var e=0;return this.state.podcasts.forEach(function(a,n){a.uuid===t&&(e=n)}),e}},{key:"findCurrentPodcast",value:function(){return this.findPodcastByUUID(this.state.currentUUID)}},{key:"playPodcast",value:function(t){this.setState(Object(c.a)({},this.state,{currentUUID:this.state.podcasts[t].uuid}))}},{key:"playPrev",value:function(){var t=this.findCurrentPodcast();t>0&&this.playPodcast(t-1)}},{key:"playNext",value:function(){var t=this.findCurrentPodcast();t<this.state.podcasts.length-1&&this.playPodcast(t+1)}},{key:"player",value:function(){return this._player.audioEl}},{key:"handleClickPodcast",value:function(t,e){e.stopPropagation(),e.preventDefault(),this.playPodcast(t)}},{key:"setVolume",value:function(t){this.player().volume=t,this.setState(Object(c.a)({},this.state,{volume:t}))}},{key:"incrementVolume",value:function(t){var e=this.state.volume,a=e;t>0&&e<1&&(a=e<=1-t?e+t:1),t<0&&e>0&&(a=e>=-t?e+t:0),a!==e&&this.setVolume(a)}},{key:"handleKey",value:function(t){var e=!0;switch(t.key){case"Enter":this.playNext();break;case" ":case"p":case"P":this.player().paused?this.player().play():this.player().pause();break;case"ArrowLeft":this.player().currentTime-=10;break;case"ArrowRight":this.player().currentTime+=10;break;case"ArrowUp":t.shiftKey?this.incrementVolume(.05):this.player().currentTime-=60;break;case"ArrowDown":t.shiftKey?this.incrementVolume(-.05):this.player().currentTime+=60;break;case"PageUp":this.player().currentTime-=600;break;case"PageDown":this.player().currentTime+=600;break;case"*":this.incrementVolume(.05);break;case"/":this.incrementVolume(-.05);break;case"m":case"M":this.player().muted=!this.player().muted;break;default:e=!1}e&&(t.stopPropagation(),t.preventDefault())}}]),e}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(P,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[11,2,1]]]);
//# sourceMappingURL=main.bf25cbcb.chunk.js.map